---
// src/sections/Contact.astro
import Icon from "@/components/Icon.astro";
import {
  contact,
  getWhatsAppLink,
} from "@/contact/contact";
import {
  getContactItems,
  type ContactItem,
} from "@/contact/adapter";

interface Props {
  id?: string;
  title: string;
  subtitle?: string;
  layout?: "simple" | "detailed";
}

const { id = "contact", title, subtitle, layout = "simple" } = Astro.props;

const items: ContactItem[] = getContactItems(layout);
const mapSrc = contact.address.embedMapUrl;
---

<section id={id} class={`contact contact--${layout}`}>
  <div class="u-container">
    <div class={`contact__container contact__container--${layout}`}>

      <!-- Información de contacto -->
      <div class="contact__info">
        <h2 class="contact__title">{title}</h2>
        {subtitle && <p class="contact__subtitle">{subtitle}</p>}

        <ul class="contact__list" aria-label="Medios de contacto">
          {items.map((item) => {
            // Evita el "p: any" implícito — todo viene tipado desde ContactItem
            const { type, label, value, icon } = item;

            return (
              <li class="contact__item">
                {icon && (
                  <div class="contact-icon">
                    <Icon name={icon} size={layout === "detailed" ? 28 : 20} decorative />
                  </div>
                )}

                <span class="contact__label">{label}:</span>

                {type === "phone" ? (() => {
                  // Busca el teléfono en la configuración tipada
                  const phone = contact.phones.find((p) => p.number === value);
                  if (!phone) return <span>{value}</span>;

                  const whatsappDesktop = getWhatsAppLink(
                    phone,
                    phone.whatsappMessage,
                    true
                  );
                  const whatsappMobile = getWhatsAppLink(
                    phone,
                    phone.whatsappMessage,
                    false
                  );

                  return (
                    <>
                      <a
                        href={whatsappDesktop}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="desktop-inline"
                      >
                        {phone.number}
                      </a>
                      <a
                        href={whatsappMobile}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="mobile-inline"
                      >
                        {phone.number}
                      </a>
                    </>
                  );
                })() : type === "address" ? (
                  <a href={contact.address.mapsLink} target="_blank" rel="noopener noreferrer">
                    {value}
                  </a>
                ) : type === "email" && contact.email ? (
                  <a href={`mailto:${contact.email}`}>{value}</a>
                ) : (
                  <span>{value}</span>
                )}
              </li>
            );
          })}
        </ul>
      </div>

      <!-- Mapa -->
      <div class={`contact__map ${layout === "detailed" ? "contact-map" : ""}`}>
        <iframe
          class={layout === "detailed" ? "map-frame" : "contact__map-frame"}
          title="Mapa del estudio en Google Maps"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          src={mapSrc}
        />
      </div>
    </div>
  </div>
</section>


<style>
.contact {
  margin-block: 3rem;
}

.contact__title {
  font-size: 1.75rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.contact__subtitle {
  margin-bottom: 1.5rem;
  color: var(--color-text-muted, #555);
}

/* ===== Contenedor general ===== */
.contact__container {
  display: grid;
  gap: 2rem;
}

.contact--simple .contact__container {
  grid-template-columns: 1fr;
}

.contact--detailed .contact__container {
  grid-template-columns: 1fr;
}

@media (min-width: 900px) {
  .contact--simple .contact__container,
  .contact--detailed .contact__container {
    grid-template-columns: 1fr 1fr;
    align-items: start;
  }
}

/* ===== Información ===== */
.contact__info {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 2rem;
  background: #fff;
  border: 1px solid var(--color-border, #ddd);
  border-radius: var(--radius-2, 8px);
}

/* ===== Lista de contacto ===== */
.contact__list {
  margin: 0;
  padding: 0;
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.contact__item {
  display: flex;
  flex-direction: row;
  gap: 0.75rem;
  align-items: flex-start;
  flex-wrap: wrap; /* Para que se apilen en Mobile si hace falta */
}

.contact__item .contact-icon {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #183c7a;
}

.contact__label {
  font-weight: 600;
  min-width: 100px; /* permite alinear los textos */
}

/* ===== Enlaces Desktop / Mobile ===== */
.desktop-inline { display: none; }
.mobile-inline { display: inline; }

@media (min-width: 768px) {
  .desktop-inline { display: inline; }
  .mobile-inline { display: none; }
}

/* ===== Mapa ===== */
.contact__map,
.contact-map {
  width: 100%;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border: 4px solid #fff;
  min-height: 300px;
}

.map-frame,
.contact__map-frame {
  width: 100%;
  height: 100%;
  border: 0;
}

@media (min-width: 1024px) {
  .contact-map {
    height: 500px;
  }
}

/* ===== Tarjetas detalladas ===== */
.contact-card {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 1rem;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  transition: box-shadow 0.3s ease;
}

.contact-card:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.contact-card .contact-icon {
  margin-bottom: 0.5rem;
}

.contact-subtitle {
  font-size: 1.125rem;
  font-weight: 700;
  color: #0b1f4b;
  margin-bottom: 0.25rem;
}

.contact-link {
  color: #183c7a;
  font-size: 1.1rem;
  font-weight: 600;
  text-decoration: none;
}

.contact-link:hover {
  text-decoration: underline;
}

.contact-schedule {
  font-size: 1rem;
  color: #111827;
  font-weight: 500;
}
</style>
