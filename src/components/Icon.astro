---
import { icons, type IconName } from '@/config/icons';
import type { ImageMetadata } from 'astro';

interface Props {
  name: IconName;
  size?: number | string;
  class?: string;
  title?: string;
  decorative?: boolean;
  color?: string;
}

const {
  name,
  size = 24,
  class: className = '',
  title,
  decorative = false,
  color = 'currentColor',
} = Astro.props;

// Recuperamos el recurso desde el diccionario
const rawSvg = icons[name] as string | ImageMetadata | undefined;

// ValidaciÃ³n defensiva
if (!rawSvg) {
  console.warn(`[Icon] Icon "${name}" no encontrado en config/icons.ts`);
}

const isRawSvg = typeof rawSvg === 'string';

let svgContent = '';
let svgUrl = '';

if (isRawSvg) {
  svgContent = (rawSvg as string)
    .replace(/\s(width|height)="[^"]*"/g, '')
    .replace(/fill=".*?"/g, 'fill="currentColor"')
    .replace(/<path(?![^>]*fill)/g, '<path fill="currentColor"');
} else if (rawSvg) {
  svgUrl = (rawSvg as ImageMetadata).src ?? '';
}
---

{isRawSvg && svgContent ? (
  <span
    class={`icon ${className}`}
    style={`--icon-size:${
      typeof size === 'number' ? size + 'px' : size
    }; color:${color};`}
    role={decorative ? 'presentation' : 'img'}
    aria-hidden={decorative ? 'true' : 'false'}
    aria-label={!decorative && title ? title : undefined}
    set:html={svgContent}
  />
) : null}

{!isRawSvg && svgUrl ? (
  <img
    src={svgUrl}
    alt={decorative ? '' : title ?? ''}
    class={`icon ${className}`}
    width={typeof size === 'number' ? size : undefined}
    height={typeof size === 'number' ? size : undefined}
    style={typeof size === 'string' ? `width:${size}; height:${size};` : undefined}
    aria-hidden={decorative ? 'true' : 'false'}
    loading="lazy"
    decoding="async"
  />
) : null}

<style>
.icon {
  display: inline-block;
  width: var(--icon-size, 1em);
  height: var(--icon-size, 1em);
  line-height: 0;
  vertical-align: middle;
  color: inherit; /* ðŸ”‘ los SVG heredan color */
}
.icon svg,
.icon img {
  display: block;
  width: 100%;
  height: 100%;
}
</style>
